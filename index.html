<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Chat</title>
    <style>
      html, body { height: 100%; margin: 0; }
      #chatbot { height: 100vh; width: 100vw; }
    </style>
  </head>
  <body>
    <div id="chatbot"></div>

    <!-- Flowise embed script -->
<script type="module">
  import Chatbot from 'https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js';

  const q = new URLSearchParams(location.search);
  const flowId    = q.get('flowId');
  const sessionId = q.get('sessionId') || q.get('chatId');

  const root = document.getElementById('chatbot');
  const log  = (...a) => console.log('[helper]', ...a);

  log('params', { flowId, sessionId });

  if (!flowId || !sessionId) {
    root.innerHTML = "<p style='padding:16px;font-family:sans-serif'>Missing flowId or sessionId.</p>";
  } else {
    try {
      // Try the "full" inline mount first (some builds require this)
      if (typeof Chatbot.initFull === 'function') {
        log('using initFull');
        Chatbot.initFull(
          {
            chatflowid: flowId,
            apiHost: 'https://flowise-production-889b.up.railway.app',
            chatflowConfig: { sessionId, chatId: sessionId },
            theme: { chatWindow: { showTitle: true, title: 'Training Chat' } }
          },
          root // mount into our div
        );
      } else {
        // Fallback to regular init with container
        log('using init (container)');
        Chatbot.init({
          chatflowid: flowId,
          apiHost: 'https://flowise-production-889b.up.railway.app',
          chatflowConfig: { sessionId, chatId: sessionId },
          container: root,
          theme: { chatWindow: { showTitle: true, title: 'Training Chat' } }
        });
      }
      log('init called');
    } catch (e) {
      log('init error', e);
      root.innerHTML =
        "<pre style='padding:16px;white-space:pre-wrap;font-family:monospace'>Init error: "
        + (e?.message || e) + "</pre>";
    }
  }
</script>
