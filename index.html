<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Chat</title>
    <style>
      html, body { height: 100%; margin: 0; }
      #chatbot { height: 100vh; width: 100vw; }
    </style>
  </head>
  <body>
    <div id="chatbot"></div>

    <!-- Flowise embed script -->
    <script type="module">
  // Load the Flowise embed as an ES module
  import Chatbot from 'https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js';

  const q = new URLSearchParams(location.search);
  const flowId    = q.get('flowId');
  const sessionId = q.get('sessionId') || q.get('chatId');

  const root = document.getElementById('chatbot');

  const log = (...args) => console.log('[helper]', ...args);

  log('params', { flowId, sessionId });

  if (!flowId || !sessionId) {
    root.innerHTML = "<p style='padding:16px;font-family:sans-serif'>Missing flowId or sessionId.</p>";
  } else {
    try {
      log('calling Chatbot.init');
      // Render INLINE into our #chatbot div (not just a floating bubble)
      Chatbot.init({
        chatflowid: flowId,
        apiHost: 'https://flowise-production-889b.up.railway.app',
        chatflowConfig: {
          sessionId: sessionId,
          chatId: sessionId
        },
        container: root,            // << ensure the chat renders in this div
        theme: {                    // optional: guarantees visible window
          chatWindow: { showTitle: true, title: 'Training Chat' }
        }
      });
      log('Chatbot.init called');
    } catch (e) {
      root.innerHTML =
        "<pre style='padding:16px;white-space:pre-wrap;font-family:monospace'>Init error: "
        + (e?.message || e) + "</pre>";
      console.error(e);
    }
  }
</script>
