<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flowise Chat â€“ Full Screen</title>
  <style>
    html, body { height: 100%; margin: 0; }
    #chat-root {
      position: fixed;
      inset: 0;
    }
  </style>
</head>
<body>
  <div id="chat-root"></div>
 
  <script type="module">
    import Chatbot from "https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js";
    
    // Clear any existing Flowise storage before starting
    try {
      const keysToRemove = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && (key.includes('flowise') || key.includes('chat'))) {
          keysToRemove.push(key);
        }
      }
      keysToRemove.forEach(key => localStorage.removeItem(key));
      sessionStorage.clear();
    } catch(e) {
      console.log("Could not clear storage:", e);
    }
 
    const params = new URLSearchParams(location.search);
    const flowId = params.get("flowId");
    const sessionId = params.get("sessionId");
    const apiHost = params.get("apiHost") || "https://flowise-production-889b.up.railway.app";
    
    if (!flowId || !sessionId) {
      document.body.innerHTML = "<p style='padding:20px'>Missing required parameters</p>";
    } else {
      Chatbot.init({
        chatflowid: flowId,
        apiHost,
        chatflowConfig: { 
          sessionId: sessionId  // This passes your session ID correctly
        },
        container: document.getElementById("chat-root"),
        theme: {
          chatWindow: {
            title: "Serapy Training Session",
            showTitle: true,
            showCloseButton: false,
            open: true,
            clearChatOnReload: true  // Also clear on reload
          }
        }
      });
